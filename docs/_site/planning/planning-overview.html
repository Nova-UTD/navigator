<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Planning - Navigator</title> <link rel="shortcut icon" href="/navigator/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/navigator/assets/css/just-the-docs-default.css"> <script src="/navigator/assets/js/vendor/lunr.min.js"></script> <script src="/navigator/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Planning | Navigator</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="Planning" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Navigator is an open-source autonomous driving system developed by Nova, an applied research group at UT Dallas." /> <meta property="og:description" content="Navigator is an open-source autonomous driving system developed by Nova, an applied research group at UT Dallas." /> <link rel="canonical" href="http://localhost:8083/navigator/planning/planning-overview.html" /> <meta property="og:url" content="http://localhost:8083/navigator/planning/planning-overview.html" /> <meta property="og:site_name" content="Navigator" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Planning" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Navigator is an open-source autonomous driving system developed by Nova, an applied research group at UT Dallas.","headline":"Planning","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:8083/navigator/assets/res/logo.png"}},"url":"http://localhost:8083/navigator/planning/planning-overview.html"}</script> <!-- End Jekyll SEO tag --> <link rel="shortcut icon" type="image/png" href="/navigator/assets/res/favicon.png"> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/navigator/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/navigator/system-overview.html" class="nav-list-link">System overview</a></li><li class="nav-list-item"><a href="/navigator/sensing/sensing-overview.html" class="nav-list-link">Sensing</a></li><li class="nav-list-item"><a href="/navigator/perception/perception-overview.html" class="nav-list-link">Perception</a></li><li class="nav-list-item active"><a href="/navigator/planning/planning-overview.html" class="nav-list-link active">Planning</a></li><li class="nav-list-item"><a href="/navigator/simulation/simulation-overview.html" class="nav-list-link">Simulation</a></li><li class="nav-list-item"><a href="/navigator/controls/controls-overview.html" class="nav-list-link">Controls</a></li><li class="nav-list-item"><a href="/navigator/interface/interface-overview.html" class="nav-list-link">Interface</a></li><li class="nav-list-item external"> <a href="https://nova-utd.github.io" class="nav-list-link external"> Learn about Nova <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Navigator" aria-label="Search Navigator" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//nova-utd.github.io" class="site-button" > Learn about Nova </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="planning-overview"> <a href="#planning-overview" class="anchor-heading" aria-labelledby="planning-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Planning overview </h1> <p><em>Maintained by Egan Johnson</em></p> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ol id="markdown-toc"> <li><a href="#the-strategy" id="markdown-toc-the-strategy">The Strategy</a></li> <li><a href="#zone-features" id="markdown-toc-zone-features">Zone Features</a></li> <li><a href="#calculating-the-trajectory-assigning-speed-to-the-path" id="markdown-toc-calculating-the-trajectory-assigning-speed-to-the-path">Calculating the Trajectory: Assigning speed to the path</a></li> <li><a href="#zone-sources" id="markdown-toc-zone-sources">Zone sources</a></li> </ol><hr /> <p>“Planning” refers to the part of the system that synthesizes perception and scenario information into an actionable decision that can be handed to controls. Our current control stack is designed for Demo 2 tasks, at its applicability to other tasks is limited.</p> <h2 id="the-strategy"> <a href="#the-strategy" class="anchor-heading" aria-labelledby="the-strategy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Strategy </h2> <p>The current strategy generates a determined path (i.e. spatial trajectory), which it assigns velocities to based on the situation. There are currently three modifying factors on assigned velocity: the speed limit, the curvature of the path (to avoid taking sharp turns at high speeds), and most importantly zones.</p> <p>A “zone” is a closed polygon that limits the speed that the vehicle can have when passing through the enclosed space. They are generated from a variety of sources, and are used to control the vehicles behavior: if any node wishes to stop the vehicle from entering an intersection, for example, they would enclose the intersection with a zone of speed 0.</p> <h2 id="zone-features"> <a href="#zone-features" class="anchor-heading" aria-labelledby="zone-features"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Zone Features </h2> <ul> <li>Zones are defined by the points describing an enclosed polygon and a non-exceed speed</li> <li>Any single zone is homogenous, meaning the non-exceed speed is constant within the zone</li> <li>Zones may overlap. In this case, the lowest non-exceed speed must be obeyed</li> <li>Zones may have a speed of 0</li> <li>Zones don’t evolve through time: instead, a new zone must replace the old zone</li> </ul> <h2 id="calculating-the-trajectory-assigning-speed-to-the-path"> <a href="#calculating-the-trajectory-assigning-speed-to-the-path" class="anchor-heading" aria-labelledby="calculating-the-trajectory-assigning-speed-to-the-path"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Calculating the Trajectory: Assigning speed to the path </h2> <p>The path is turned into a trajectory by assigning speed. The trajectory should be safe, comfortable, and possible, and should obey the zones. The process for assigning velocities works as follows:</p> <ol> <li>For each point, set its speed to the speed limit of the lane</li> <li>For each point, calculate the local curvature of the path. Using the path curvature, limit the speed for that point so that the lateral acceleration of the vehicle is never more than a configured maximum</li> <li>For each zone, determine if it intersects with the trajectory. If it does: <ol> <li>The trajectory is a discrete path, so the first point affected may be further from the edge of the zone than we would like. To observe the speed limitation starting from the very edge of the zone, insert a new point to the trajectory where it intersects the zone (both entering and exiting)</li> <li>Set the speed of this new point to the lowest speed among its adjacent points the zone</li> <li>For all points within the zone, set the speed to no greater than the zone speed</li> </ol> </li> <li>Do a backwards pass of the trajectory, and lower the speed of each point so that the speed of the next point (next in time, previous point in the pass) can be achieved with comfortable deceleration. The only time this may not be physically obtainable is immediately in front of the vehicle when it is moving too fast: in this case, lower the speed anyway and let the controller sort it out</li> <li>Do a forwards pass of the trajectory, and lower the speed of each point so it can be reached from the previous point using a comfortable acceleration</li> </ol> <p>Although the path itself may extend from the origin to the destination, only the points within a certain horizon of the vehicle need to be considered for the trajectory.</p> <p>Notice that aside from step 1, the speed is never increased. The vehicle should be cautious, meaning that if there is a reason to go slow and a reason to go regular speed, the reason to go slow wins as a rule of thumb. Since this is true, as long as acceleration/deceleration smoothing is done last, the other steps can be done in any order.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">MotionPlannerNode</span><span class="o">::</span><span class="n">send_message</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ideal_path</span> <span class="o">==</span> <span class="nb">nullptr</span> <span class="o">||</span> <span class="n">odometry</span> <span class="o">==</span> <span class="nb">nullptr</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// RCLCPP_WARN(this-&gt;get_logger(), "motion planner has no input path, skipping...");</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Trajectory</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">build_trajectory</span><span class="p">(</span><span class="n">ideal_path</span><span class="p">,</span> <span class="n">horizon</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">zones</span> <span class="o">!=</span> <span class="nb">nullptr</span><span class="p">){</span>
      <span class="n">limit_to_zones</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="o">*</span><span class="n">zones</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">limit_to_curvature</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">max_lat_accel</span><span class="p">);</span>
    <span class="n">smooth</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">max_accel</span><span class="p">,</span> <span class="n">max_decel</span><span class="p">);</span>
    <span class="n">trajectory_publisher</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="zone-sources"> <a href="#zone-sources" class="anchor-heading" aria-labelledby="zone-sources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Zone sources </h2> <p>Zones primarily come from two sources: the obstacle detection system and the <code class="language-plaintext highlighter-rouge">BehaviorPlanner</code> node.</p> <p>The obstacle detection system will create a zone around each obstacle. It will actually typically create two zones: one zone with a speed of 0 signifying not to move through the space at all, and one larger zone with a lower speed indicating where the vehicle may pass but should be cautious.</p> <p>One limitation of the zone architecture is that obstacle zones need to be larger than the actual obstacles. This is because speeds are assigned as intersections with the trajectory, which has zero width. The car does not have zero width, and so can physically go through zones that the path did not intersect.</p> <p>At this time, the primary function of the BehaviorPlanner node is traffic control. Using a state machine, it will create zones around intersections, and then remove them when it is safe to proceed.</p> <p>## Strengths and Weaknesses</p> <p>Strengths:</p> <ul> <li>Zones are an easily understood description of what the car is doing</li> <li>Zones can accomplish any sort of stop-go behavior we need, including following another vehicle</li> </ul> <p>Weaknesses:</p> <ul> <li>Zones cannot describe dynamic scenarios</li> <li>Zones cannot describe uncertain or branching scenarios</li> <li>Only as strong as the zone-creating entities</li> <li>Can be awkward for the controller, like when it is halfway out of a zone with 0 speed</li> </ul> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
