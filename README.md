## This branch aims to solve SLAM and map-based-localization.

### Setup
- The dockerfile in this branch should build everything properly. Run ```docker compose build navigator_carla``` Email adipu@utexas.edu if you have issues.
- This pipeline has been tested with vehicle spawner disabled in carla, and using carla_manual_control. Set these in carla launchfile

### src/lidar_SLAM
- Ros2 package that uses ```combined_map.pcd``` located in ```resource/```. To replace this, ```combined_map.pcd``` must be replaced with another pointcloud file of the same name and extension. Since the file in the build directory is referenced, you must ```colcon build``` if manually replacing the ```combined_map.pcd``` file.
- The localization node is automatically run with navigator when ```launch launches/launch.carla.py``` is executed, but it can also be run by executing ```run lidar_localization localization_node```
  - Rviz should be set up on this branch to show the gnss_gt vector alongside the vector returned by the localization node, but if not:
    - Navigate to the view tab under panes, then set the frame to base_link.
    - In the left toolbar, set the fixed frame to the map frame.
    - In the left toolbar, click add, then under topics add the odometry topics under gnss_gt and lidar_localization.
  - You might see a little lag until the localized pose arrow shows up, as global registration takes some time and needs a high-fidelity scan. It should show up by the time you drive a little.
- The mapping node uses ```kiss-slam``` to generate maps. All you need to do is run ```ros2 run lidar_SLAM mapping_node``` once you are ready to begin recording the map, then hit ```ctrl+c``` when you're finished. The node will auto-save the ```combined_map.pcd``` to both the current working directory and to the build resource folder, so you can immediately run ```localization_node``` again (or relaunch navigator) and have the new map and init pose file. However, if you rebuild your ros2 workspace without first copying the created files from your working directory to the src/lidar_SLAM/resource folder, it will overwrite the build resource folder. So make sure you copy them over from your CWD before rebuilding if you want changes to persist.

### src/mapping/lidar_slam_testing
- This folder contains offline python scripts that allow for the testing and viewing of trajectories generated by kiss-slam, as well as by the same localization pipeline that runs in the ros node mentioned above

## IMPORTANT NOTE:
Currently, the ```mapping_node``` uses gnss_gt to get an initial position for the pointcloud map. You must drive forward until the message ```Initial Pose Determined.``` is seen in the terminal window where ```mapping_node``` is being run. This means the initial orientation has also been determined, and the system are ready to proceed with mapping.