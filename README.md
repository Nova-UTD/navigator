## This branch aims to solve SLAM and map-based-localization.

### setup
the dockerfile in this branch should build everything properly. Run ```docker compose build navigator_carla``` Email adipu@utexas.edu if you have issues.

### src/lidar_SLAM
- Ros2 package that uses ```combined_map.pcd``` annd ```init.txt``` located in ```resource/```. To replace this, combined_map.pcd must be replaced with another pointcloud file of the same name and extension. Since the file in the build directory is referenced, you must ```colcon build``` if manually replacing the ```combined_map.pcd``` and ```init.txt``` files.
- The localization node is automatically run when ```launch launches/launch.carla.py``` is executed, but it can also be run by executing ```run lidar_localization localization_node```
  - Rviz should be set up on this branch to show the gnss_gt vector alongside the vector returned by the localization node, but if not:
    - Navigate to the view tab under panes, then set the frame to base_link.
    - In the left toolbar, set the fixed frame to the map frame.
    - In the left toolbar, click add, then under topics add the odometry topics under gnss_gt and lidar_localization.
- The mapping node uses ```kiss-slam``` to generate maps. All you need to do is run ```ros2 run lidar_SLAM mapping_node``` once you are ready to begin recording the map, then hit ```ctrl+c``` when you're finished. The node will auto-save the map file and ```init.txt``` to both the current working directory and to the build resource folder, so you can immediately run ```localization_node``` again and have the new map and init pose file. However, if you rebuild your ros2 workspace without first copying the created files from your working directory to the src/lidar_SLAM/resource folder, it will overwrite the build resource folder. So make sure you copy them over before rebuilding if you want changes to persist.

### src/mapping/lidar_slam_testing
- This folder contains offline python scripts that allow for the testing and viewing of trajectories generated by kiss-slam, as well as by the same localization pipeline that runs in the ros node mentioned above

## IMPORTANT NOTE:
Currently, the mapping node uses gnss_gt to get an initial pose for the pointcloud map. This initial pose is saved to ```init.txt``` and used by ```localization_node``` as a starting guess for kiss-icp. 

## Current Flaw:
If you don't start mapping at carla start point, and restart carla, localization node will have the wrong starting point and will likely never converge to your true location. This can probably be fixed in the near future by implementing global ICP on the map using open3d to get an initial pose and use the superior kiss-icp odometry to go from there. 
    
